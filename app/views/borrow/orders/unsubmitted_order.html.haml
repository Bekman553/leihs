- content_for :title, _("Order Overview")

.wrapper
  
  .row.margin-top-m
    %nav
      %ul
        %li
          %a.navigation-tab-item.margin-right-xxs.padding-horizontal-m.float-left.active
            %i.icon-shopping-cart
            = _("Order")

  .row.content-wrapper.straight-top-left.padding-inset-l

    %h1.headline-xl.padding-bottom-s= _("Order Overview")

    - @grouped_lines.each_pair do |date_ip, lines|
      .emboss.deep.padding-bottom-s.margin-bottom-m
        .row.padding-inset-s
          .col1of6.headline-m
            = short_date(date_ip[0])
          .col5of6.headline-m
            = date_ip[1]

        %div
          - lines.sort_by {|x| x.model.to_s }.each do |line|
            .row.line
              - unless line.available?
                .line-info.red
              .line-col.col1of9.image
                %img.max-height-xxs-alt.max-width-xs{src: model_image_thumb_path(line.model.id)}
              .line-col.col1of9.amount
                = line.quantity
              .line-col.col2of9.text-align-left.name
                %strong{:title => "#{line.model.name}"}= line.model.name.truncate(62)
                - if line.model.is_package
                  .package.icon
              .line-col.col2of9.text-align-left.manufacturer
                %strong{:title => "#{line.model.manufacturer}"}= line.model.manufacturer.truncate(62)
              .line-col.col2of9.end_date
                = interval(line.start_date, line.end_date)
                = _("until")
                %span{class: line.inventory_pool.is_open_on?(line.end_date) ? nil : "emboss red"}
                  = short_date(line.end_date)

              .line-col.line-actions.col1of9
                = link_to borrow_order_remove_lines_path(line_ids: [line.id]), method: :delete, data: { confirm: _("Are you sure?") }, class: "button red" do
                  .icon.delete
                  = _("Delete")

    = form_tag borrow_order_path do
      .row
        .col1of2
        .col1of2
          %textarea.min-width-full{name: "purpose", placeholder: _("Please provide a purpose...")}
            = @order.purpose

      .row
        .col1of6
          = link_to borrow_order_remove_path, method: :delete, data: { confirm: _("Are you sure?") }, class: "button red min-width-full" do
            %i.icon-trash
            = _("Delete")
        .col4of6
        .col1of6
          %button.button.green.min-width-full
            %i.icon-ok
            = _("Order")
